{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Plan",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "caseId": { "type": "string", "description": "Identificador único do caso" },
    "title": { "type": "string", "description": "Título em pt-BR, específico e atraente" },
    "location": {
      "type": "string",
      "description": "Local verossímil; pode ser abstrato (ex.: 'shopping center', 'galpão logístico') ou cidade/UF sem endereço"
    },
    "incidentType": { "type": "string", "description": "Tipo de crime adequado ao nível" },
    "difficulty": {
      "type": "string",
      "enum": ["Rookie","Detective","Detective2","Sergeant","Lieutenant","Captain","Commander"],
      "description": "Nível de dificuldade aplicado"
    },
    "timezone": {
      "type": "string",
      "pattern": "^[A-Za-z_]+\\/[A-Za-z_]+$",
      "description": "Zona IANA usada nos timestamps (ex.: America/Sao_Paulo)"
    },
    "estimatedDuration": {
      "type": "number",
      "minimum": 10,
      "description": "Duração estimada em minutos"
    },
    "overview": { "type": "string", "description": "Resumo envolvente do caso (pt-BR)" },
    "learningObjectives": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" },
      "description": "Objetivos de aprendizagem alinhados ao nível"
    },
    "mainElements": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" },
      "description": "Elementos principais que guiarão o desenvolvimento"
    },
    "timeline": {
      "type": "array",
      "description": "Eventos canônicos com timestamps ISO-8601 **com offset**",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "eventId": { "type": "string" },
          "ts": {
            "type": "string",
            "format": "date-time",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(?:\\.[0-9]{1,6})?(?:Z|[+-][0-9]{2}:[0-9]{2})$",
            "description": "Timestamp ISO-8601 com offset (ex.: 2025-08-30T22:15:00-03:00)"
          },
          "title": { "type": "string" },
          "loc": { "type": "string", "description": "Local do evento; pode ser abstrato" }
        },
        "required": ["eventId","ts","title"]
      }
    },
    "minDetectiveRank": {
      "type": "string",
      "enum": ["Rook","Detective","Detective2","Sergeant","Lieutenant","Captain","Commander"],
      "description": "Rank mínimo do jogador para este caso"
    },
    "profileApplied": {
      "type": "object",
      "additionalProperties": false,
      "description": "Resumo dos ranges efetivamente aplicados a partir do perfil de dificuldade",
      "properties": {
        "suspects": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "documents": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "evidences": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "gatingSteps": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "falseLeads": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "interpretiveComplexity": { "type": "string" }
      },
      "required": ["suspects","documents","evidences","gatingSteps","falseLeads","interpretiveComplexity"]
    },
    "goldenTruth": {
      "type": "object",
      "additionalProperties": false,
      "description": "Fatos verdadeiros selados (não revelar solução nos documentos).",
      "properties": {
        "facts": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "id": { "type": "string" },
              "about": { "type": "string" },
              "minSupports": { "type": "integer", "minimum": 2 },
              "heterogeneous": { "type": "boolean", "description": "Se os suportes devem vir de fontes variadas" }
            },
            "required": ["id","about","minSupports"]
          }
        },
        "sealed": { "type": "boolean", "default": true },
        "hash": { "type": "string", "description": "Hash opcional do conteúdo selado" }
      },
      "required": ["facts"]
    }
  },
  "required": [
    "caseId",
    "title",
    "location",
    "incidentType",
    "difficulty",
    "timezone",
    "estimatedDuration",
    "overview",
    "learningObjectives",
    "mainElements",
    "timeline",
    "minDetectiveRank",
    "profileApplied",
    "goldenTruth"
  ]
}