{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DocumentAndMediaSpecs",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "caseId": { "type": "string" },
    "version": { "type": "string" },

    "documentSpecs": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "docId": {
            "type": "string",
            "pattern": "^[a-z0-9_\\-]+$",
            "description": "Unique identifier in the case"
          },
          "type": {
            "type": "string",
            "enum": [
              "police_report",
              "interview",
              "memo_admin",
              "forensics_report",
              "evidence_log",
              "witness_statement"
            ],
            "description": "Document type"
          },
          "title": {
            "type": "string",
            "description": "Human-readable title (in Portuguese)"
          },
          "sections": {
            "type": "array",
            "minItems": 1,
            "items": { "type": "string" },
            "description": "Required sections of the document"
          },
          "lengthTarget": {
            "type": "array",
            "minItems": 2,
            "maxItems": 2,
            "items": { "type": "integer", "minimum": 50 },
            "description": "Target word range [min, max]"
          },
          "gated": {
            "type": "boolean",
            "default": false,
            "description": "Access-gated document"
          },
          "gatingRule": {
            "type": "object",
            "additionalProperties": false,
            "description": "Unlock rule when gated=true",
            "properties": {
              "action": {
                "type": "string",
                "enum": [
                  "requires_evidence",
                  "requires_document",
                  "requires_decision",
                  "role_required",
                  "manual_unlock",
                  "submit_evidence"
                ]
              },
              "evidenceId": { "type": "string" },
              "docId": { "type": "string" },
              "notes": { "type": "string" }
            },
            "required": ["action"]
          }
        },
        "required": [
          "docId",
          "type",
          "title",
          "sections",
          "lengthTarget",
          "gated"
        ],
        "allOf": [
          {
            "if": { "properties": { "gated": { "const": true } } },
            "then": { "required": ["gatingRule"] }
          },
          {
            "if": { "properties": { "type": { "const": "forensics_report" } } },
            "then": {
              "properties": {
                "sections": {
                  "contains": {
                    "type": "string",
                    "pattern": "(?i)chain of custody|cadeia de cust[Ã³o]dia"
                  }
                }
              }
            }
          }
        ]
      }
    },

    "mediaSpecs": {
      "type": "array",
      "minItems": 0,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "evidenceId": {
            "type": "string",
            "pattern": "^[a-z0-9_\\-]+$",
            "description": "Unique identifier of the media item"
          },
          "kind": {
            "type": "string",
            "enum": ["photo", "document_scan", "diagram", "audio", "video"],
            "description": "Media type"
          },
          "title": {
            "type": "string",
            "description": "Human-readable title (in Portuguese)"
          },
          "prompt": {
            "type": "string",
            "description": "Prompt for generating the media"
          },
          "constraints": {
            "type": "object",
            "description": "Additional constraints (lighting, angle, anonymization, etc.)",
            "additionalProperties": { "type": ["string", "number", "boolean"] }
          },
          "deferred": {
            "type": "boolean",
            "default": false,
            "description": "Set to true if the type is not yet supported"
          }
        },
        "required": [
          "evidenceId",
          "kind",
          "title",
          "prompt",
          "constraints",
          "deferred"
        ]
      }
    }
  },
  "required": ["documentSpecs", "mediaSpecs"]
}