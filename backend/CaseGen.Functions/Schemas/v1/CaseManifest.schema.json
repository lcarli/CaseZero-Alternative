{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CaseManifest",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "caseId": {
      "type": "string",
      "pattern": "^CASE-[0-9]{8}-[a-f0-9]{8}$",
      "description": "Unique case identifier"
    },
    "version": {
      "type": "string",
      "description": "Schema version"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp"
    },
    "bundlePaths": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Relative paths to bundle contents"
    },
    "documents": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ManifestEntry"
      }
    },
    "media": {
      "type": "array", 
      "items": {
        "$ref": "#/definitions/ManifestEntry"
      }
    },
    "fileHashes": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "SHA-256 hashes of files for integrity checking"
    },
    "visibility": {
      "$ref": "#/definitions/CaseVisibility"
    }
  },
  "required": [
    "caseId",
    "version",
    "generatedAt", 
    "bundlePaths",
    "documents",
    "media",
    "fileHashes",
    "visibility"
  ],
  "definitions": {
    "ManifestEntry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Document ID or Evidence ID"
        },
        "relativePath": {
          "type": "string",
          "description": "Path relative to bundle root"
        },
        "type": {
          "type": "string",
          "description": "Content type"
        },
        "gated": {
          "type": "boolean",
          "description": "Whether access is gated"
        },
        "hash": {
          "type": "string",
          "description": "SHA-256 hash for integrity"
        },
        "sizeBytes": {
          "type": "integer",
          "minimum": 0,
          "description": "File size in bytes"
        }
      },
      "required": [
        "id",
        "relativePath", 
        "type",
        "gated",
        "hash",
        "sizeBytes"
      ]
    },
    "CaseVisibility": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "alwaysVisible": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of items always visible to players"
        },
        "gatedVisible": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of items visible but require unlock"
        },
        "hiddenUntilUnlocked": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of items completely hidden until unlocked"
        }
      },
      "required": [
        "alwaysVisible",
        "gatedVisible", 
        "hiddenUntilUnlocked"
      ]
    }
  }
}