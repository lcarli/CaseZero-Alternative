{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Plan",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "caseId": { "type": "string", "description": "Unique case identifier" },
    "title": { "type": "string", "description": "Title in Portuguese, specific and engaging" },
    "location": {
      "type": "string",
      "description": "Plausible location; can be abstract (e.g., 'shopping center', 'logistics warehouse') or city/state without address"
    },
    "incidentType": { "type": "string", "description": "Type of crime appropriate to the level" },
    "difficulty": {
      "type": "string",
      "enum": ["Rookie","Detective","Detective2","Sergeant","Lieutenant","Captain","Commander"],
      "description": "Applied difficulty level"
    },
    "timezone": {
      "type": "string",
      "pattern": "^[A-Za-z_]+\\/[A-Za-z_]+$",
      "description": "IANA timezone used in timestamps (e.g., America/Sao_Paulo)"
    },
    "estimatedDuration": {
      "type": "number",
      "minimum": 10,
      "description": "Estimated duration in minutes"
    },
    "overview": { "type": "string", "description": "Engaging case summary (in Portuguese)" },
    "learningObjectives": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" },
      "description": "Learning objectives aligned to the level"
    },
    "mainElements": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" },
      "description": "Main elements that will guide the development"
    },
    "timeline": {
      "type": "array",
      "description": "Canonical events with ISO-8601 timestamps **with offset**",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "eventId": { "type": "string" },
          "ts": {
            "type": "string",
            "format": "date-time",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(?:\\.[0-9]{1,6})?(?:Z|[+-][0-9]{2}:[0-9]{2})$",
            "description": "ISO-8601 timestamp with offset (e.g., 2025-08-30T22:15:00-03:00)"
          },
          "title": { "type": "string" },
          "loc": { "type": "string", "description": "Event location; can be abstract" }
        },
        "required": ["eventId","ts","title"]
      }
    },
    "minDetectiveRank": {
      "type": "string",
      "enum": ["Rook","Detective","Detective2","Sergeant","Lieutenant","Captain","Commander"],
      "description": "Minimum player rank for this case"
    },
    "profileApplied": {
      "type": "object",
      "additionalProperties": false,
      "description": "Summary of ranges effectively applied from the difficulty profile",
      "properties": {
        "suspects": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "documents": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "evidences": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "gatingSteps": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "falseLeads": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
        "interpretiveComplexity": { "type": "string" }
      },
      "required": ["suspects","documents","evidences","gatingSteps","falseLeads","interpretiveComplexity"]
    },
    "goldenTruth": {
      "type": "object",
      "additionalProperties": false,
      "description": "Sealed true facts (do not reveal solution in documents).",
      "properties": {
        "facts": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "id": { "type": "string" },
              "about": { "type": "string" },
              "minSupports": { "type": "integer", "minimum": 2 },
              "heterogeneous": { "type": "boolean", "description": "Whether supports should come from varied sources" }
            },
            "required": ["id","about","minSupports"]
          }
        },
        "sealed": { "type": "boolean", "default": true },
        "hash": { "type": "string", "description": "Optional hash of sealed content" }
      },
      "required": ["facts"]
    }
  },
  "required": [
    "caseId",
    "title",
    "location",
    "incidentType",
    "difficulty",
    "timezone",
    "estimatedDuration",
    "overview",
    "learningObjectives",
    "mainElements",
    "timeline",
    "minDetectiveRank",
    "profileApplied",
    "goldenTruth"
  ]
}