################################################################################
#                                                                              #
#                   CASEGEN - PIPELINE STEP-BY-STEP TESTING                   #
#                                                                              #
#  Este arquivo permite testar cada etapa do pipeline de gera√ß√£o de casos     #
#  de forma isolada e sequencial. √ötil para debug e desenvolvimento.          #
#                                                                              #
#  FLUXO COMPLETO:                                                             #
#  1. PlanStepOnly        ‚Üí Cria caso + gera plano                            #
#  2. ExpandStepByCaseId  ‚Üí Expande detalhes (suspeitos, evid√™ncias, etc)    #
#  3. DesignStepByCaseId  ‚Üí Design de documentos e m√≠dias                     #
#  4. GenerateStepByCaseId ‚Üí Gera conte√∫do final (textos/imagens)            #
#  5. NormalizeStepByCaseId ‚Üí Normaliza e finaliza caso                       #
#                                                                              #
################################################################################

@baseUrl = http://localhost:7071

# ‚ö†Ô∏è IMPORTANTE: Atualize este caseId ap√≥s executar o Step 1 (PlanStepOnly)
@caseId = CASE-20251113-098f27e8

################################################################################
# üìù STEP 1: PLAN - Criar caso e gerar plano inicial
################################################################################
# Cria um novo caso e executa apenas a etapa de planejamento.
# Retorna: caseId (use-o nos pr√≥ximos steps!)
# Dura√ß√£o: ~30-60 segundos
# Storage: Salva plan.json no blob

### STEP 1A - Plan para caso Rookie (f√°cil)
POST {{baseUrl}}/api/PlanStepOnly
Content-Type: application/json

{
  "difficulty": "Rookie",
  "timezone": "America/Toronto"
}

### STEP 1B - Plan para caso Detective (m√©dio)
POST {{baseUrl}}/api/PlanStepOnly
Content-Type: application/json

{
  "difficulty": "Detective",
  "timezone": "America/Toronto"
}

### STEP 1C - Plan para caso Sergeant (avan√ßado)
POST {{baseUrl}}/api/PlanStepOnly
Content-Type: application/json

{
  "difficulty": "Sergeant",
  "timezone": "America/New_York"
}


################################################################################
# üîç STEP 2: EXPAND - Expandir detalhes do caso
################################################################################
# Busca o plan.json do storage e expande os detalhes:
#   - Suspeitos (perfis detalhados)
#   - Evid√™ncias (descri√ß√µes completas)
#   - Timeline (sequ√™ncia de eventos)
#   - Testemunhas
# Dura√ß√£o: ~60-90 segundos
# Storage: Salva expand/*.json (suspects, evidence, timeline, witnesses)

### STEP 2 - Expand (use o caseId do Step 1)
POST {{baseUrl}}/api/ExpandStepByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}"
}


################################################################################
# üé® STEP 3: DESIGN - Design de documentos e m√≠dias
################################################################################
# Busca plan.json e expand/*.json do storage e cria o design:
#   - Cat√°logo de documentos (relat√≥rios, entrevistas, etc)
#   - Cat√°logo de m√≠dias (fotos, v√≠deos, √°udios)
#   - Especifica√ß√µes visuais
#   - Estrutura narrativa
# Dura√ß√£o: ~90-120 segundos
# Storage: Salva design/*.json (documents, media, specs)

### STEP 3 - Design (use o caseId dos steps anteriores)
POST {{baseUrl}}/api/DesignStepByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}"
}


################################################################################
# ‚ú® STEP 4: GENERATE - Gerar conte√∫do final
################################################################################
# üéØ STEP 4: GENERATE - Gerar conte√∫do detalhado
################################################################################
# IMPORTANTE: A gera√ß√£o de documentos √© LENTA (2-3 minutos por documento)!
# 
# Recomenda√ß√£o: Use a OP√á√ÉO D para gerar documento por documento
# - Evita timeouts HTTP
# - Permite acompanhar progresso em tempo real
# - Pode pausar e continuar quando quiser

################################################################################
# üîπ STEP 4 - OP√á√ÉO D: Generate UM DOCUMENTO POR VEZ (RECOMENDADO)
################################################################################
# Gera apenas 1 documento por requisi√ß√£o (~2-3 minutos cada)
# Use o √≠ndice (0-based) para especificar qual documento gerar

### STEP 4D-1 - Gerar documento 0 (primeiro documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 0
}

### STEP 4D-2 - Gerar documento 1 (segundo documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 1
}

### STEP 4D-3 - Gerar documento 2 (terceiro documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 2
}

### STEP 4D-4 - Gerar documento 3 (quarto documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 3
}

### STEP 4D-5 - Gerar documento 4 (quinto documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 4
}

### STEP 4D-6 - Gerar documento 5 (sexto documento)
POST {{baseUrl}}/api/GenerateSingleDocumentByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "documentIndex": 5
}

### STEP 4D-MEDIA-1 - Gerar media 0 (primeira m√≠dia)
POST {{baseUrl}}/api/GenerateSingleMediaByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "mediaIndex": 0
}

### STEP 4D-MEDIA-2 - Gerar media 1 (segunda m√≠dia)
POST {{baseUrl}}/api/GenerateSingleMediaByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}",
  "mediaIndex": 1
}


################################################################################
# üîπ STEP 4 - OP√á√ÉO A: Generate COMPLETO (ORIGINAL - vai dar timeout!)
################################################################################
# N√ÉO USE ESTA OP√á√ÉO - deixada apenas para refer√™ncia
# Tenta gerar tudo de uma vez - SEMPRE d√° timeout em casos grandes

### STEP 4A-1 - Generate SEM imagens (AINDA MUITO LENTO)
# POST {{baseUrl}}/api/GenerateStepByCaseId
# Content-Type: application/json
# 
# {
#   "caseId": "{{caseId}}",
#   "generateImages": false,
#   "renderFiles": false
# }


################################################################################
# üîπ STEP 4 - OP√á√ÉO B: Generate POR LOTES (VAI DAR TIMEOUT - N√ÉO USE)
################################################################################
# N√ÉO USE ESTA OP√á√ÉO - lotes de 3 documentos ainda demoram ~8 minutos
# Deixada apenas para refer√™ncia

### STEP 4B-1 - Gerar lote 0-3 (VAI DAR TIMEOUT)
# POST {{baseUrl}}/api/GenerateDocumentsStepByCaseId
# Content-Type: application/json
# 
# {
#   "caseId": "{{caseId}}",
#   "batchStart": 0,
#   "batchEnd": 3
# }


################################################################################
# üîπ STEP 4 - OP√á√ÉO C: Progress Check
################################################################################
# Verifica quantos documentos e media j√° foram gerados.

### STEP 4C - Verificar progresso da gera√ß√£o
POST {{baseUrl}}/api/GetGenerateProgressByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}"
}


################################################################################
# üéØ STEP 5: NORMALIZE - Normalizar e finalizar caso
################################################################################
# Busca todos os dados gerados e executa normaliza√ß√£o final:
#   - Valida√ß√£o de integridade
#   - Ajustes de formata√ß√£o
#   - Gera√ß√£o de metadados finais
#   - Cria√ß√£o do bundle final
# Dura√ß√£o: ~10-20 segundos
# Storage: Salva bundle final compactado

### STEP 5 - Normalize (finaliza o caso)
POST {{baseUrl}}/api/NormalizeStepByCaseId
Content-Type: application/json

{
  "caseId": "{{caseId}}"
}


################################################################################
# üîß UTILIT√ÅRIOS - Helpers para debug
################################################################################

### Verificar status de um caso no storage
GET {{baseUrl}}/api/GetCaseStatus?caseId={{caseId}}

### Listar todos os arquivos de um caso no blob storage
GET {{baseUrl}}/api/ListCaseFiles?caseId={{caseId}}

### Baixar plan.json de um caso espec√≠fico
GET {{baseUrl}}/api/GetCaseFile?caseId={{caseId}}&file=plan.json

### Baixar expand completo de um caso
GET {{baseUrl}}/api/GetCaseFile?caseId={{caseId}}&file=expand/suspects.json


################################################################################
# üìä EXEMPLOS DE FLUXOS COMPLETOS
################################################################################

### FLUXO 1: Desenvolvimento R√°pido (sem imagens)
# 1. Execute STEP 1A (Plan Rookie)
# 2. Copie o caseId retornado e atualize @caseId no topo do arquivo
# 3. Execute STEP 2 (Expand)
# 4. Execute STEP 3 (Design)
# 5. Execute STEP 4A (Generate sem imagens)
# 6. Execute STEP 5 (Normalize)
# Tempo total: ~4-6 minutos

### FLUXO 2: Produ√ß√£o com Imagens
# 1. Execute STEP 1B (Plan Detective)
# 2. Atualize @caseId
# 3. Execute STEP 2 ‚Üí 3 ‚Üí 4B ‚Üí 5
# Tempo total: ~18-30 minutos

### FLUXO 3: Debug de Etapa Espec√≠fica
# Se voc√™ quer apenas re-executar o Expand de um caso existente:
# 1. Atualize @caseId com um caso que j√° tem plan.json
# 2. Execute apenas STEP 2
# O sistema busca o plan existente e reprocessa apenas o Expand

################################################################################
# üí° DICAS
################################################################################
# 
# ‚Ä¢ Use vari√°veis de ambiente (@caseId) para evitar copy/paste
# ‚Ä¢ Cada step √© independente e pode ser re-executado
# ‚Ä¢ √ötil para testar mudan√ßas incrementais em cada etapa
# ‚Ä¢ Logs detalhados em cada endpoint mostram tempo e tokens
# ‚Ä¢ Storage √© preservado entre execu√ß√µes
#
################################################################################
